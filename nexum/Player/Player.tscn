[gd_scene load_steps=24 format=3 uid="uid://dkep3cjgp021n"]

[ext_resource type="PackedScene" uid="uid://crasywkns4el2" path="res://Models/character-d.fbx" id="1_xhfnw"]
[ext_resource type="Script" uid="uid://cffbtlw20u75c" path="res://Scripts/player.gd" id="2_tok1r"]
[ext_resource type="PackedScene" uid="uid://cxakgkyja58j3" path="res://Player/healthbar.tscn" id="3_tok1r"]
[ext_resource type="Script" uid="uid://d0d5awbbg10ie" path="res://Scripts/shieldbar.gd" id="4_8g4oa"]
[ext_resource type="PackedScene" uid="uid://dbyxgr1dj38ce" path="res://Player/shieldbar.tscn" id="4_ddoul"]
[ext_resource type="Script" uid="uid://ddqy70tqlh6qy" path="res://Player/spring_arm_3d.gd" id="6_6ysni"]

[sub_resource type="BoxShape3D" id="BoxShape3D_ddoul"]
size = Vector3(1.6169434, 2.7216644, 1)

[sub_resource type="ViewportTexture" id="ViewportTexture_6ysni"]
viewport_path = NodePath("SubViewport")

[sub_resource type="ViewportTexture" id="ViewportTexture_8g4oa"]
viewport_path = NodePath("SubViewport")

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_j23h2"]
animation = &"holding-left-shoot"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_0j2ni"]
animation = &"attack-melee-left"

[sub_resource type="AnimationNodeOneShot" id="AnimationNodeOneShot_v0k0e"]
filters = ["character-d/root/torso", "character-d/root/torso/arm-left", "character-d/root/torso/arm-right", "character-d/root/torso/head"]
mix_mode = 1

[sub_resource type="AnimationNodeBlend2" id="AnimationNodeBlend2_tok1r"]
filter_enabled = true
filters = ["character-d/root/torso/arm-left", "character-d/root/torso/arm-right"]

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_ddoul"]
animation = &"holding-left"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_8g4oa"]
animation = &"idle"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_6ysni"]
animation = &"walk"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_vlldt"]
animation = &"sprint"

[sub_resource type="AnimationNodeBlendSpace2D" id="AnimationNodeBlendSpace2D_s1rgi"]
blend_point_0/node = SubResource("AnimationNodeAnimation_8g4oa")
blend_point_0/pos = Vector2(0, 0)
blend_point_1/node = SubResource("AnimationNodeAnimation_6ysni")
blend_point_1/pos = Vector2(0, 1)
blend_point_2/node = SubResource("AnimationNodeAnimation_vlldt")
blend_point_2/pos = Vector2(1, 0)

[sub_resource type="AnimationNodeTransition" id="AnimationNodeTransition_5wa8t"]
input_0/name = "attack"
input_0/auto_advance = false
input_0/break_loop_at_end = false
input_0/reset = true
input_1/name = "shoot"
input_1/auto_advance = false
input_1/break_loop_at_end = false
input_1/reset = true

[sub_resource type="AnimationNodeBlendTree" id="AnimationNodeBlendTree_j23h2"]
graph_offset = Vector2(-161.93689, 140.17072)
nodes/output/position = Vector2(1080, 240)
nodes/Movement/node = SubResource("AnimationNodeBlendSpace2D_s1rgi")
nodes/Movement/position = Vector2(60, 200)
nodes/HoldWeapon/node = SubResource("AnimationNodeAnimation_ddoul")
nodes/HoldWeapon/position = Vector2(260, 320)
nodes/Blend2/node = SubResource("AnimationNodeBlend2_tok1r")
nodes/Blend2/position = Vector2(500, 140)
nodes/AttackType/node = SubResource("AnimationNodeOneShot_v0k0e")
nodes/AttackType/position = Vector2(840, 220)
nodes/Transition/node = SubResource("AnimationNodeTransition_5wa8t")
nodes/Transition/position = Vector2(580, 460)
nodes/Animation/node = SubResource("AnimationNodeAnimation_0j2ni")
nodes/Animation/position = Vector2(300, 500)
"nodes/Animation 2/node" = SubResource("AnimationNodeAnimation_j23h2")
"nodes/Animation 2/position" = Vector2(300, 680)
node_connections = [&"output", 0, &"AttackType", &"Blend2", 0, &"Movement", &"Blend2", 1, &"HoldWeapon", &"AttackType", 0, &"Blend2", &"AttackType", 1, &"Transition", &"Transition", 0, &"Animation", &"Transition", 1, &"Animation 2"]

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_0j2ni"]
advance_mode = 2

[sub_resource type="AnimationNodeStateMachine" id="AnimationNodeStateMachine_tok1r"]
states/BlendTree/node = SubResource("AnimationNodeBlendTree_j23h2")
states/BlendTree/position = Vector2(435, 100)
transitions = ["Start", "BlendTree", SubResource("AnimationNodeStateMachineTransition_0j2ni")]

[sub_resource type="SeparationRayShape3D" id="SeparationRayShape3D_6ysni"]

[node name="character-d" node_paths=PackedStringArray("weapon_holder") instance=ExtResource("1_xhfnw")]
script = ExtResource("2_tok1r")
weapon_holder = NodePath("character-d/root/torso/arm-left/WeaponHolder")

[node name="root" parent="character-d" index="0"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.07889942, 0)

[node name="leg-left" parent="character-d/root" index="0"]
transform = Transform3D(1, 0, 0, 0, 0.6227004, 0.78246015, 0, -0.78246015, 0.6227004, 0.2, 1, 2.0348877e-14)

[node name="leg-right" parent="character-d/root" index="1"]
transform = Transform3D(1, 0, 0, 0, 0.6227004, -0.78246015, 0, 0.78246015, 0.6227004, -0.2, 1, 2.183782e-14)

[node name="torso" parent="character-d/root" index="2"]
transform = Transform3D(1, 0, 0, 0, 0.9999998, 0, 0, 0, 0.9999998, 0, 0.7, 0)

[node name="arm-left" parent="character-d/root/torso" index="0"]
transform = Transform3D(1, 0, 0, 0, 0.87736946, -0.47981483, 0, 0.47981483, 0.87736946, 0.39999998, 1.1, -0.099999994)

[node name="WeaponHolder" type="Marker3D" parent="character-d/root/torso/arm-left" index="0"]
transform = Transform3D(-1, 8.742278e-08, 3.821371e-15, 0, -4.371139e-08, 1, 8.742278e-08, 1, 4.371139e-08, 0.19661295, -1.2016525, -0.0016025528)

[node name="arm-right" parent="character-d/root/torso" index="1"]
transform = Transform3D(1, 0, 0, 0, 0.68615705, 0.72745335, 0, -0.72745335, 0.68615705, -0.4000001, 1.1, -0.099999994)

[node name="head" parent="character-d/root/torso" index="2"]
transform = Transform3D(0.09696284, 0, -0.024458231, 0, 0.1, 0, 0.024458231, 0, 0.09696284, 0, 1.2, 0)

[node name="CollisionShape3D" type="CollisionShape3D" parent="." index="2"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0.010131836, 1.3498015, 0)
shape = SubResource("BoxShape3D_ddoul")

[node name="DataBars" type="Node3D" parent="." index="3"]
transform = Transform3D(0.86958975, 0, 0.49377495, 0, 1, 0, -0.49377495, 0, 0.86958975, 0.08698356, 2.8101664, -0.53695333)

[node name="Shield" type="Node3D" parent="DataBars" index="0"]

[node name="Sprite3D" parent="DataBars/Shield" index="0" instance=ExtResource("4_ddoul")]
transform = Transform3D(0.51190794, 0, -0.85904044, 0, 1, 0, 0.85904044, 0, 0.51190794, -0.34544975, 0.61622524, 0.34372)
texture = SubResource("ViewportTexture_6ysni")
script = ExtResource("4_8g4oa")
max_shield = 100

[node name="Health" type="Node3D" parent="DataBars" index="1"]

[node name="Sprite3D" parent="DataBars/Health" index="0" instance=ExtResource("3_tok1r")]
transform = Transform3D(0.8693225, 0, -0.49424535, 0, 1, 0, 0.49424535, 0, 0.8693225, -0.33689624, 0.20813084, 0.3469968)
texture = SubResource("ViewportTexture_8g4oa")

[node name="AnimationTree" type="AnimationTree" parent="." index="4"]
tree_root = SubResource("AnimationNodeStateMachine_tok1r")
anim_player = NodePath("../AnimationPlayer")
parameters/BlendTree/Movement/blend_position = Vector2(-0.0015847683, 1.0358744)
parameters/BlendTree/Blend2/blend_amount = 0.2
parameters/BlendTree/AttackType/active = false
parameters/BlendTree/AttackType/internal_active = false
parameters/BlendTree/AttackType/request = 0
parameters/BlendTree/Transition/current_state = ""
parameters/BlendTree/Transition/transition_request = ""
parameters/BlendTree/Transition/current_index = -1

[node name="SpringArm3D" type="SpringArm3D" parent="." index="5" node_paths=PackedStringArray("target")]
transform = Transform3D(1, 0, 0, 0, 0.5, 0.86602557, 0, -0.86602557, 0.5, 0, 0, 0)
shape = SubResource("SeparationRayShape3D_6ysni")
spring_length = 10.0
margin = 0.1
script = ExtResource("6_6ysni")
target = NodePath("..")
follow_speed = 15.0

[node name="Camera3D" type="Camera3D" parent="SpringArm3D" index="0"]
current = true

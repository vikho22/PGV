[gd_scene load_steps=26 format=3 uid="uid://cbamc4hkrjmp6"]

[ext_resource type="PackedScene" uid="uid://ddstckrtjx7ck" path="res://Models/character-d.fbx" id="1_xhfnw"]
[ext_resource type="Script" uid="uid://cffbtlw20u75c" path="res://Scripts/player.gd" id="2_tok1r"]
[ext_resource type="PackedScene" uid="uid://cxakgkyja58j3" path="res://Player/healthbar.tscn" id="3_tok1r"]
[ext_resource type="Script" path="res://Scripts/shieldbar.gd" id="4_8g4oa"]
[ext_resource type="PackedScene" uid="uid://d27tj8y0adgty" path="res://Player/shieldbar.tscn" id="4_ddoul"]
[ext_resource type="Script" uid="uid://ddqy70tqlh6qy" path="res://Player/spring_arm_3d.gd" id="6_6ysni"]

[sub_resource type="BoxShape3D" id="BoxShape3D_6ysni"]
size = Vector3(0.39904785, 0.2722168, 0.4111328)

[sub_resource type="BoxShape3D" id="BoxShape3D_ddoul"]
size = Vector3(1.6169434, 2.7216644, 0.8024292)

[sub_resource type="ViewportTexture" id="ViewportTexture_6ysni"]
viewport_path = NodePath("SubViewport")

[sub_resource type="ViewportTexture" id="ViewportTexture_8g4oa"]
viewport_path = NodePath("SubViewport")

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_j23h2"]
animation = &"holding-left-shoot"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_0j2ni"]
animation = &"attack-melee-left"

[sub_resource type="AnimationNodeOneShot" id="AnimationNodeOneShot_v0k0e"]
filters = ["character-d/root/torso", "character-d/root/torso/arm-left", "character-d/root/torso/arm-right", "character-d/root/torso/head"]
mix_mode = 1

[sub_resource type="AnimationNodeBlend2" id="AnimationNodeBlend2_tok1r"]
filter_enabled = true
filters = ["character-d/root/torso/arm-left", "character-d/root/torso/arm-right"]

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_ddoul"]
animation = &"holding-left"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_8g4oa"]
animation = &"idle"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_6ysni"]
animation = &"walk"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_vlldt"]
animation = &"sprint"

[sub_resource type="AnimationNodeBlendSpace2D" id="AnimationNodeBlendSpace2D_s1rgi"]
blend_point_0/node = SubResource("AnimationNodeAnimation_8g4oa")
blend_point_0/pos = Vector2(0, 0)
blend_point_1/node = SubResource("AnimationNodeAnimation_6ysni")
blend_point_1/pos = Vector2(0, 1)
blend_point_2/node = SubResource("AnimationNodeAnimation_vlldt")
blend_point_2/pos = Vector2(1, 0)

[sub_resource type="AnimationNodeTransition" id="AnimationNodeTransition_5wa8t"]
input_0/name = "attack"
input_0/auto_advance = false
input_0/break_loop_at_end = false
input_0/reset = true
input_1/name = "shoot"
input_1/auto_advance = false
input_1/break_loop_at_end = false
input_1/reset = true

[sub_resource type="AnimationNodeBlendTree" id="AnimationNodeBlendTree_j23h2"]
graph_offset = Vector2(143.77283, 700.274)
nodes/output/position = Vector2(1080, 240)
nodes/Movement/node = SubResource("AnimationNodeBlendSpace2D_s1rgi")
nodes/Movement/position = Vector2(60, 200)
nodes/HoldWeapon/node = SubResource("AnimationNodeAnimation_ddoul")
nodes/HoldWeapon/position = Vector2(260, 320)
nodes/Blend2/node = SubResource("AnimationNodeBlend2_tok1r")
nodes/Blend2/position = Vector2(500, 140)
nodes/AttackType/node = SubResource("AnimationNodeOneShot_v0k0e")
nodes/AttackType/position = Vector2(840, 220)
nodes/Transition/node = SubResource("AnimationNodeTransition_5wa8t")
nodes/Transition/position = Vector2(580, 460)
nodes/Animation/node = SubResource("AnimationNodeAnimation_0j2ni")
nodes/Animation/position = Vector2(300, 500)
"nodes/Animation 2/node" = SubResource("AnimationNodeAnimation_j23h2")
"nodes/Animation 2/position" = Vector2(300, 680)
node_connections = [&"output", 0, &"AttackType", &"Blend2", 0, &"Movement", &"Blend2", 1, &"HoldWeapon", &"AttackType", 0, &"Blend2", &"AttackType", 1, &"Transition", &"Transition", 0, &"Animation", &"Transition", 1, &"Animation 2"]

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_0j2ni"]
advance_mode = 2

[sub_resource type="AnimationNodeStateMachine" id="AnimationNodeStateMachine_tok1r"]
states/BlendTree/node = SubResource("AnimationNodeBlendTree_j23h2")
states/BlendTree/position = Vector2(435, 100)
transitions = ["Start", "BlendTree", SubResource("AnimationNodeStateMachineTransition_0j2ni")]

[sub_resource type="SeparationRayShape3D" id="SeparationRayShape3D_6ysni"]

[sub_resource type="BoxShape3D" id="BoxShape3D_8g4oa"]
size = Vector3(1.6190491, 2.7250977, 0.81677246)

[node name="character-d" node_paths=PackedStringArray("weapon_holder") instance=ExtResource("1_xhfnw")]
collision_layer = 3
collision_mask = 3
script = ExtResource("2_tok1r")
weapon_holder = NodePath("character-d/root/torso/arm-left/WeaponHolder")

[node name="root" parent="character-d" index="0"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.0067289984, 0)

[node name="leg-left" parent="character-d/root" index="0"]
transform = Transform3D(1, 0, 0, 0, 0.99861073, -0.05268939, 0, 0.05268939, 0.99861073, 0.2, 1, 2.0348877e-14)

[node name="leg-right" parent="character-d/root" index="1"]
transform = Transform3D(1, 0, 0, 0, 0.9986107, 0.052689295, 0, -0.052689295, 0.9986107, -0.2, 1, 2.183782e-14)

[node name="torso" parent="character-d/root" index="2"]
transform = Transform3D(1, 0, 0, 0, 0.9999998, 0, 0, 0, 0.9999998, 0, 0.7, 0)

[node name="arm-left" parent="character-d/root/torso" index="0"]
transform = Transform3D(1, 0, 0, 0, 0.9293855, 0.3691096, 0, -0.3691096, 0.9293855, 0.39999998, 1.1, -0.099999994)

[node name="Area3D" type="Area3D" parent="character-d/root/torso/arm-left" index="0"]
transform = Transform3D(1, 0, 0, 0, 0.99999946, 0.0010894275, 0, -0.0010894275, 0.99999946, -0.39999986, -1.79989, 0.10196082)
collision_layer = 0
collision_mask = 8
monitoring = false

[node name="CollisionShape3D" type="CollisionShape3D" parent="character-d/root/torso/arm-left/Area3D" index="0"]
transform = Transform3D(1.5, 0, 0, 0, 1.5, 1.1641532e-10, 0, -1.1641532e-10, 1.5, 0.6190376, 0.9343668, -0.103027366)
shape = SubResource("BoxShape3D_6ysni")

[node name="WeaponHolder" type="Marker3D" parent="character-d/root/torso/arm-left" index="1"]
transform = Transform3D(1, 0, 0, 0, 0.9999998, 0, 0, 0, 0.9999998, 0.2107017, -1.2219224, 0)

[node name="arm-right" parent="character-d/root/torso" index="1"]
transform = Transform3D(1, 0, 0, 0, 0.9979595, -0.06384808, 0, 0.06384808, 0.9979595, -0.4000001, 1.1, -0.099999994)

[node name="head" parent="character-d/root/torso" index="2"]
transform = Transform3D(0.099892765, 0, 0.0046293754, 0, 0.1, 0, -0.0046293754, 0, 0.099892765, 0, 1.2, 0)

[node name="CollisionShape3D" type="CollisionShape3D" parent="." index="2"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0.010131836, 1.3498015, 0.00033569336)
shape = SubResource("BoxShape3D_ddoul")

[node name="DataBars" type="Node3D" parent="." index="3"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 3, 0)

[node name="Shield" type="Node3D" parent="DataBars" index="0"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.4, 0)

[node name="Sprite3D" parent="DataBars/Shield" index="0" instance=ExtResource("4_ddoul")]
transform = Transform3D(1.0000001, 0, 0, 0, 1, 0, 0, 0, 1.0000001, 0, 0, 0)
texture = SubResource("ViewportTexture_6ysni")
script = ExtResource("4_8g4oa")
max_shield = 100

[node name="Health" type="Node3D" parent="DataBars" index="1"]

[node name="Sprite3D" parent="DataBars/Health" index="0" instance=ExtResource("3_tok1r")]
texture = SubResource("ViewportTexture_8g4oa")

[node name="AnimationTree" type="AnimationTree" parent="." index="4"]
tree_root = SubResource("AnimationNodeStateMachine_tok1r")
anim_player = NodePath("../AnimationPlayer")
parameters/BlendTree/Movement/blend_position = Vector2(-0.0015847683, 1.0358744)
parameters/BlendTree/Blend2/blend_amount = 0.2
parameters/BlendTree/AttackType/active = false
parameters/BlendTree/AttackType/internal_active = false
parameters/BlendTree/AttackType/request = 0
parameters/BlendTree/Transition/current_state = ""
parameters/BlendTree/Transition/transition_request = ""
parameters/BlendTree/Transition/current_index = -1

[node name="SpringArm3D" type="SpringArm3D" parent="." index="5" node_paths=PackedStringArray("target")]
transform = Transform3D(1, 0, 0, 0, 0.34202018, 0.93969274, 0, -0.93969274, 0.34202018, 0, 0, 0)
shape = SubResource("SeparationRayShape3D_6ysni")
spring_length = 10.0
margin = 0.1
script = ExtResource("6_6ysni")
target = NodePath("..")
follow_speed = 15.0

[node name="Camera3D" type="Camera3D" parent="SpringArm3D" index="0"]
current = true

[node name="Hurtbox" type="Area3D" parent="." index="6"]
collision_layer = 4
collision_mask = 0

[node name="CollisionShape3D" type="CollisionShape3D" parent="Hurtbox" index="0"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0.002609253, 1.3557129, -0.0026245117)
shape = SubResource("BoxShape3D_8g4oa")

[connection signal="area_entered" from="character-d/root/torso/arm-left/Area3D" to="." method="_on_area_3d_area_entered"]
